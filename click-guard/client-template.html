<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .loader-container {
            text-align: center;
            color: white;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loader-text {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .loader-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="loader-container">
        <div class="spinner"></div>
        <p class="loader-text">í˜ì´ì§€ë¡œ ì´ë™ ì¤‘ì…ë‹ˆë‹¤...</p>
        <p class="loader-subtext">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
    </div>

    <script>
    (function() {
        // ============================================
        // ğŸ”§ ê´‘ê³ ì£¼ë³„ ì„¤ì • (ì´ ë¶€ë¶„ë§Œ ìˆ˜ì •)
        // ============================================
        const CONFIG = {
            // ê´‘ê³ ì£¼ ì‹ë³„ì (ì˜ë¬¸, ìˆ«ìë§Œ)
            clientId: 'dampd21',
            
            // ìµœì¢… ëœë”© í˜ì´ì§€ URL
            targetUrl: 'https://m.place.naver.com/restaurant/1309812619/',
            
            // Google Apps Script ì›¹ì•± URL
            scriptUrl: 'https://script.google.com/macros/s/AKfycbyWzaUUMvN_U8zkP2OO-Iu4jE_nXUZe00jzjKQhMfDhFBu9wDKrqOyN1DeE-JL-VR1n/exec',
            
            // ë¶€ì •í´ë¦­ íŒë‹¨ ê¸°ì¤€
            thresholds: {
                // ê°™ì€ IPì—ì„œ NíšŒ ì´ìƒ í´ë¦­ ì‹œ ì˜ì‹¬
                maxClicksPerIp: 3,
                // ê°™ì€ ê¸°ê¸°ì—ì„œ NíšŒ ì´ìƒ í´ë¦­ ì‹œ ì˜ì‹¬  
                maxClicksPerDevice: 5,
                // ì²´ë¥˜ì‹œê°„ Nì´ˆ ë¯¸ë§Œ ì‹œ ì˜ì‹¬
                minStaySeconds: 2
            }
        };
        // ============================================

        // í˜ì´ì§€ ë¡œë“œ ì‹œê°„
        const pageLoadTime = Date.now();

        // ë¸Œë¼ìš°ì € í•‘ê±°í”„ë¦°íŠ¸ ìƒì„±
        function generateFingerprint() {
            const components = [
                navigator.userAgent,
                navigator.language,
                screen.width + 'x' + screen.height,
                screen.colorDepth,
                new Date().getTimezoneOffset(),
                navigator.hardwareConcurrency || 'unknown',
                navigator.deviceMemory || 'unknown',
                navigator.platform
            ];
            
            // ê°„ë‹¨í•œ í•´ì‹œ ìƒì„±
            let hash = 0;
            const str = components.join('|');
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16);
        }

        // URL íŒŒë¼ë¯¸í„° íŒŒì‹±
        function getUrlParams() {
            const params = {};
            const searchParams = new URLSearchParams(window.location.search);
            for (const [key, value] of searchParams) {
                params[key] = value;
            }
            return params;
        }

        // í´ë¦­ ë°ì´í„° ìˆ˜ì§‘
        function collectClickData() {
            const urlParams = getUrlParams();
            
            return {
                // ê¸°ë³¸ ì •ë³´
                clientId: CONFIG.clientId,
                timestamp: new Date().toISOString(),
                
                // ë¸Œë¼ìš°ì €/ê¸°ê¸° ì •ë³´
                fingerprint: generateFingerprint(),
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screenResolution: screen.width + 'x' + screen.height,
                colorDepth: screen.colorDepth,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                
                // ë°©ë¬¸ ì •ë³´
                referrer: document.referrer || 'direct',
                currentUrl: window.location.href,
                
                // ê´‘ê³  íŒŒë¼ë¯¸í„° (ë„¤ì´ë²„/ì¹´ì¹´ì˜¤ ë“±)
                adParams: {
                    // ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³ 
                    n_media: urlParams.n_media || '',
                    n_query: urlParams.n_query || '',
                    n_rank: urlParams.n_rank || '',
                    n_ad_group: urlParams.n_ad_group || '',
                    n_ad: urlParams.n_ad || '',
                    n_keyword_id: urlParams.n_keyword_id || '',
                    n_keyword: urlParams.n_keyword || '',
                    n_campaign_type: urlParams.n_campaign_type || '',
                    n_ad_group_type: urlParams.n_ad_group_type || '',
                    
                    // UTM íŒŒë¼ë¯¸í„°
                    utm_source: urlParams.utm_source || '',
                    utm_medium: urlParams.utm_medium || '',
                    utm_campaign: urlParams.utm_campaign || '',
                    utm_content: urlParams.utm_content || '',
                    utm_term: urlParams.utm_term || '',
                    
                    // ê¸°íƒ€ íŒŒë¼ë¯¸í„°
                    gclid: urlParams.gclid || '',  // Google
                    fbclid: urlParams.fbclid || '', // Facebook
                    kakao_id: urlParams.kakao_id || '' // Kakao
                },
                
                // íŒë‹¨ ê¸°ì¤€
                thresholds: CONFIG.thresholds
            };
        }

        // ë°ì´í„° ì „ì†¡
        function sendData(data) {
            // Beacon API ì‚¬ìš© (í˜ì´ì§€ ì´ë™ ì‹œì—ë„ ì „ì†¡ ë³´ì¥)
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            
            if (navigator.sendBeacon) {
                navigator.sendBeacon(CONFIG.scriptUrl, blob);
            } else {
                // Fallback: fetch
                fetch(CONFIG.scriptUrl, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: { 'Content-Type': 'application/json' },
                    keepalive: true
                }).catch(() => {});
            }
        }

        // ì²´ë¥˜ì‹œê°„ ì¸¡ì • í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸
        function redirectWithDelay() {
            const stayTime = (Date.now() - pageLoadTime) / 1000;
            const data = collectClickData();
            data.stayTimeSeconds = stayTime;
            
            // ë°ì´í„° ì „ì†¡
            sendData(data);
            
            // ìµœì¢… í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            setTimeout(function() {
                window.location.href = CONFIG.targetUrl;
            }, 100);
        }

        // ìµœì†Œ ì²´ë¥˜ì‹œê°„ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ë„ˆë¬´ ë¹¨ë¦¬ ë‚˜ê°€ë©´ ì˜ì‹¬)
        setTimeout(redirectWithDelay, 1500);

        // í˜ì´ì§€ ë– ë‚  ë•Œë„ ë°ì´í„° ì „ì†¡ (ì¡°ê¸° ì´íƒˆ ê°ì§€)
        window.addEventListener('beforeunload', function() {
            const stayTime = (Date.now() - pageLoadTime) / 1000;
            if (stayTime < 1.5) {
                const data = collectClickData();
                data.stayTimeSeconds = stayTime;
                data.earlyExit = true;
                sendData(data);
            }
        });

    })();
    </script>
</body>
</html>
